<?php $flag = false; ?>
<?php $request = Zend_Controller_Front::getInstance()->getRequest(); ?>
<?php if ($request->isMobile()): ?>
    <?php if ($this->has('predicates')): ?>
    <?php $odd = true; $current = 0; $graphCount = count($this->graphs) ?>
    <ul data-role="listview" data-inset="true" role="listbox" about="<?php echo $this->resourceUri ?>">
        <?php foreach ($this->predicates as $graph => $predicatesForGraph): ?>
            <?php $current++; ?>
            <?php if (count($this->predicates[$graph]) > 0): /* has resource predicates from graph at all? */ ?>
                <?php $flag = true; ?>

            <?php foreach ($predicatesForGraph as $uri => $predicate): ?>
                <?php $currentPredicate = $this->predicates[$graph][$uri] ?>
                    <li data-role="list-divider" role="heading" about="<?php echo $currentPredicate['uri'] ?>">
                        <?php echo $currentPredicate['title'] ?>
                    </li>
                    <?php if (count($this->values[$graph][$uri]) > 1): ?>
                        <?php foreach ($this->values[$graph][$uri] as $entry): ?>
                            <li role="option">
                                    <a rel="<?php echo $currentPredicate['curi'] ?>"
                                       about="<?php echo $entry['url'] ?>"
                                       content="<?php echo $entry['uri'] ?>"
                                       onclick="onInstanceClick(this, false); return false;" href="#"
                                       ><?php echo $entry['object'] ?></a>
                            </li>
                        <?php endforeach; ?>
                        <?php if (isset($currentPredicate['has_more']) && $currentPredicate['has_more']): ?>
                            <li role="option"><a href="#" onclick="pageList(this, true); return false;" about="<?php echo $currentPredicate['has_more_link'] ?>">[<?php echo $this->_('more') ?>]</a></li>
                        <?php endif; ?>
                    <?php else: ?>
                        <?php $entry = current($this->values[$graph][$uri]) ?>
                            <?php if ($entry['url']): ?>
                                <li role="option">
                                    <a about="<?php echo $entry['url'] ?>"
                                       content="<?php echo $entry['uri'] ?>"
                                       onclick="onInstanceClick(this, false); return false;" href="#"
                                       ><?php echo $entry['object'] ?></a>
                                 </li>
                            <?php else: ?>
                                 <li role="option">
                                    <span property="<?php echo $currentPredicate['curi'] ?>"
                                              <?php if (isset($entry['lang']) && !empty($entry['lang'])): ?>
                                                            xml:lang="<?php echo $entry['lang'] ?>"
                                                    <?php elseif (isset($entry['datatype']) && !empty($entry['datatype'])): ?>
                                                      datatype="<?php echo $entry['datatype'] ?>"
                                              <?php endif; ?>
                                              ><?php echo $entry['object'] ?></span>
                                 </li>
                            <?php endif; ?>
                        <?php endif; ?>
                <?php endforeach; ?>
            <?php endif; ?>
        <?php endforeach; ?>
    </ul>
    <?php endif; ?>
    <?php if (!$flag): ?>
        <p class="messagebox info"><?php echo $this->_('No predicates found.') ?></p>
    <?php endif; ?>
<?php else: ?>
	<?php if (isset($this->prePropertiesContent)): ?>
    	<div><?php echo $this->prePropertiesContent; ?></div>    
	<?php endif; ?>
    <?php if (isset($this->prePropertiesContent)): ?>
        <div><?php echo $this->prePropertiesContent; ?></div>
    <?php endif; ?>
    <span about="<?php echo $this->resourceUri ?>" style="display:none" class="about_span"></span>
    <?php if ($this->has('predicates')): ?>
    <?php $odd = true; $current = 0; $graphCount = count($this->graphs) ?>
    <table class="separated-vertical rdfa" about="<?php echo $this->resourceUri ?>"
        <?php foreach ($this->namespaces as $namespace => $prefix): ?>
            <?php echo ' xmlns:' . $prefix . '="' . $namespace . '"' ?>
        <?php endforeach; ?>>

        <?php foreach ($this->predicates as $graph => $predicatesForGraph): ?>
            <?php $current++; ?>
            <?php if (count($this->predicates[$graph]) > 0): /* has resource predicates from graph at all? */ ?>
                <?php $flag = true; ?>
            <tbody update:from="<?php echo $graph ?>" id="table-group-<?php echo $current ?>">
                <?php if (($graphCount > 1) || ($graph != $this->graphUri)): ?>
                    <?php /* show tbody caption only if statements from more than one graph or not from the selected graph */ ?>
                    <tr class="grouptitle">
                        <th colspan="2">
                            <a class="toggle"></a>
                            <?php echo ($graph != $this->graphUri) ? $this->_('Imported from ') : '' ?>
                            <?php echo $this->graphs[$graph] ?>
                        </th>
                    </tr>
                <?php endif; ?>
            <?php foreach ($predicatesForGraph as $uri => $predicate): ?>
                <?php $currentPredicate = $this->predicates[$graph][$uri] ?>
                <tr>
                    <td width="25%">
                        <a class="hasMenu"
                           about="<?php echo $currentPredicate['uri'] ?>"
                           href="<?php echo $currentPredicate['url'] ?>"><?php echo $currentPredicate['title'] ?></a>
                    </td>
                    <?php if (count($this->values[$graph][$uri]) > 1): ?>
                    <?php
                        // if there is at least one resource in this value list -> show list icon
                        $hasContexMenu = false;
                        foreach ($this->values[$graph][$uri] as $entry) {
                             if ($entry['url']) {
                                 $hasContexMenu = true;
                             }
                        }
                    ?>
                                    <td>
                                            <div class="<?php echo $this->editable ? 'editable' : '' ?>  <?php echo $hasContexMenu ? 'has-contextmenu-area' : '' ?>">
                                                    <?php if ($hasContexMenu): ?>
                                                            <div class="contextmenu">
                                                                    <a class="item"
                                                                       href="<?php echo (isset($currentPredicate['has_more_link']) ? $currentPredicate['has_more_link'] : "") ?>">
                                                                            <span class="icon icon-list" title="Show as List">
                                                                                    <span>Show as List</span>
                                                                            </span>
                                                                    </a>
                                                            </div>
                                                    <?php endif; ?>
                                                    <ul class="bullets-none">
                                                            <?php foreach ($this->values[$graph][$uri] as $entry): ?>
                                                                    <?php if ($entry['url']): ?>
                                                                            <li>
                                                                                    <a resource="<?php echo $entry['uri'] ?>"
                                                                                       rel="<?php echo $currentPredicate['curi'] ?>"
                                                                                       class="expandable hasMenu" href="<?php echo $entry['url'] ?>"><?php echo $entry['object'] ?></a>
                                                                            </li>
                                                                    <?php else: ?>
                                                                            <li property="<?php echo $currentPredicate['curi'] ?>"
                                                                                    content="<?php echo $this->escape($entry['content']) ?>"
                                                                                    <?php if (isset($entry['lang']) && !empty($entry['lang'])): ?>
                                                                                            xml:lang="<?php echo $entry['lang'] ?>"
                                                                                    <?php elseif (isset($entry['datatype']) && !empty($entry['datatype'])): ?>
                                                                                            datatype="<?php echo $entry['datatype'] ?>"
                                                                                    <?php endif; ?>
                                                                                    ><?php
                                                                                    echo $entry['object']
                                                                            ?></li>
                                                                    <?php endif; ?>
                                                            <?php endforeach; ?>
                                                            <?php if (isset($currentPredicate['has_more']) && $currentPredicate['has_more']): ?>
                                                                    <a href="<?php echo $currentPredicate['has_more_link'] ?>">[<?php echo $this->_('more') ?>]</a>
                                                            <?php endif; ?>
                                                    </ul>
                                            </div>
                    </td>
                    <?php else: ?>
                        <?php $entry = current($this->values[$graph][$uri]) ?>
                                    <td>
                                            <div class="<?php echo $this->editable ? 'editable' : '' ?>">
                                                    <?php if ($entry['url']): ?>
                                                            <?php if ($entry['uri']): ?>
                                                                    <a rel="<?php echo $currentPredicate['curi'] ?>"
                                                                       class="expandable hasMenu"
                                                                       resource="<?php echo $entry['uri'] ?>"
                                                                       href="<?php echo $entry['url'] ?>"><?php echo $entry['object'] ?></a>
                                                            <?php else: ?>
                                                                    <a rel="<?php echo $currentPredicate['curi'] ?>"
                                                                       href="<?php echo $entry['url'] ?>"><?php echo $entry['object'] ?></a>
                                                            <?php endif; ?>
                                                    <?php else: ?>
                                                            <span property="<?php echo $currentPredicate['curi'] ?>"
                                                                      content="<?php echo $this->escape($entry['content']) ?>"
                                                                      <?php if (isset($entry['lang']) && !empty($entry['lang'])): ?>
                                                                                    xml:lang="<?php echo $entry['lang'] ?>"
                                                                            <?php elseif (isset($entry['datatype']) && !empty($entry['datatype'])): ?>
                                                                              datatype="<?php echo $entry['datatype'] ?>"
                                                                      <?php endif; ?>
                                                            ><?php echo $entry['object'] ?></span>
                                                    <?php endif; ?>
                                            </div>
                    </td>
                    <?php endif; ?>
                </tr>
            <?php endforeach; ?>
        </tbody>
        <?php endif; ?>
        <?php endforeach; ?>
    </table>
    <?php endif; ?>
    <?php if (!$flag): ?>
        <p class="messagebox info"><?php echo $this->_('No predicates found.') ?></p>
    <?php endif; ?>
<?php endif; ?>
